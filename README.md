# شبیه‌ساز بوت ESP32 

این پروژه یک نرم‌افزار تعبیه‌شده (firmware) برای میکروکنترلر ESP32 است که فرآیند بوت یک سیستم فرضی را بر روی نمایشگر OLED (SSD1306) شبیه‌سازی می‌کند. هدف از این شبیه‌سازی، نمایش بصری مراحل مختلف تست سخت‌افزار، گزارش خطاها و تعامل اولیه با کاربر از طریق دکمه است. این پروژه برای نمایشگرهای دو رنگ (زرد و آبی) بهینه‌سازی شده است تا از تفکیک بصری بخش‌های مختلف رابط کاربری بهره ببرد.

## قابلیت‌های کلیدی

* **رابط کاربری گرافیکی بر روی OLED:** نمایش اطلاعات و وضعیت‌ها بر روی نمایشگر 128x64 SSD1306.
* **شبیه‌سازی فرآیند بوت:** اجرای یک توالی از تست‌های سخت‌افزاری فرضی با نمایش نام قطعه و پیشرفت عملیات.
* **نمایش وضعیت تست‌ها:** گزارش وضعیت موفقیت (`OK`) یا بروز خطا (`ERROR`) برای هر یک از قطعات شبیه‌سازی شده.
* **نوار پیشرفت پویا:** نمایش بصری درصد پیشرفت هر تست با به‌روزرسانی ۱٪ به ۱٪ برای روانی بیشتر.
* **بهره‌گیری از نمایشگر دو رنگ:** استفاده از بخش زرد نمایشگر برای عناوین ثابت (مانند "...Booting") و بخش آبی برای جزئیات متغیر.
* **سیگنال‌دهی LED:** استفاده از LED داخلی ESP32 برای نشانه‌گذاری خطاها (روشن شدن لحظه‌ای برای هر خطا و روشن ماندن در صورت وجود خطای کلی در پایان بوت).
* **تعامل کاربر:** دریافت ورودی از طریق دکمه `BOOT` (GPIO0) برای شروع و راه‌اندازی مجدد شبیه‌سازی.
* **مدیریت حالت:** پیاده‌سازی یک ماشین حالت (State Machine) ساده برای کنترل جریان اجرای برنامه (صفحه اولیه، انتظار، بوت، پایان بوت).

## نیازمندی‌های سخت‌افزاری

* **میکروکنترلر:** برد توسعه مبتنی بر ESP32 (مانند ESP32-DevKitC یا مشابه).
* **نمایشگر:** ماژول OLED SSD1306 با ابعاد 128x64 پیکسل و رابط I2C.
    * این پروژه برای نمایشگرهای دو رنگ (بخش بالایی زرد، بخش پایینی آبی) بهینه‌سازی شده است. پارامتر `YELLOW_SECTION_HEIGHT` در کد (پیش‌فرض ۱۶) ارتفاع بخش زرد را مشخص می‌کند. در صورت استفاده از نمایشگر تک‌رنگ، تمامی عناصر با رنگ واحد نمایشگر نشان داده خواهند شد.
* **ورودی:** دکمه فشاری `BOOT` متصل به GPIO0 (معمولاً بر روی برد تعبیه شده است).
* **خروجی بصری:** LED آبی داخلی متصل به GPIO2 (معمولاً بر روی برد تعبیه شده است).

## نیازمندی‌های نرم‌افزاری و کتابخانه‌ها

* **محیط توسعه:** Arduino IDE (نسخه پیشنهادی 1.8.19 یا بالاتر، یا Arduino IDE 2.x).
* **پشتیبانی برد ESP32:** نصب پکیج ESP32 core برای Arduino IDE از طریق Board Manager.
* **کتابخانه‌های مورد نیاز:**
    * `Adafruit GFX Library`
    * `Adafruit SSD1306`
    * `Wire.h` (کتابخانه استاندارد آردوینو برای ارتباط I2C)

    این کتابخانه‌ها از طریق Library Manager در Arduino IDE قابل جستجو و نصب هستند (`Sketch > Include Library > Manage Libraries...`).

## راه‌اندازی و اجرا

1.  پروژه را در Arduino IDE باز کنید.
2.  از منوی `Tools > Board`، برد ESP32 مورد استفاده خود را انتخاب نمایید.
3.  پورت سریال متصل به ESP32 را از منوی `Tools > Port` انتخاب کنید.
4.  اطمینان حاصل کنید که تمامی کتابخانه‌های مورد نیاز نصب شده‌اند.
5.  در صورت لزوم، مقدار `YELLOW_SECTION_HEIGHT` را در ابتدای کد متناسب با نمایشگر خود تنظیم کنید.
6.  کد را بر روی برد ESP32 آپلود نمایید.
7.  پس از آپلود، شبیه‌ساز با نمایش صفحه اولیه (Splash Screen) اجرا خواهد شد.
8.  با فشردن دکمه `BOOT` روی برد ESP32، فرآیند شبیه‌سازی بوت آغاز می‌شود.
9.  پس از اتمام، با فشردن مجدد دکمه `BOOT`، شبیه‌سازی از ابتدا قابل اجراست.

## ساختار کلی کد

* **ماشین حالت (State Machine):** منطق اصلی برنامه توسط یک `switch` بر روی متغیر `currentState` پیاده‌سازی شده که وضعیت‌های `SPLASH_SCREEN`, `WAITING_FOR_START`, `BOOTING_PHASE`, و `BOOT_FINISHED` را مدیریت می‌کند.
* **تابع `simulateHardwareTest()`:** این تابع مسئول شبیه‌سازی تست هر یک از قطعات، شامل نمایش متن "...Booting" در بخش زرد، نام قطعه و نوار پیشرفت در بخش آبی، و در نهایت نتیجه تست (OK/ERROR) است.
* **تابع `displayCenteredMessage()`:** برای نمایش پیام‌های بزرگ و مرکزی مانند "ERROR" استفاده می‌شود.
* **تقسیم‌بندی نمایشگر:** محاسبات مربوط به مختصات Y برای قرارگیری صحیح عناصر در بخش‌های زرد و آبی نمایشگر (در صورت استفاده از نمایشگر دو رنگ) انجام شده است.

## پارامترهای قابل تنظیم (سفارشی‌سازی)

* **لیست قطعات و وضعیت آن‌ها:** در بخش `case BOOTING_PHASE:` داخل تابع `loop()`، می‌توانید لیست قطعات (`componentName`)، وضعیت موفقیت یا شکست هر تست (`shouldFail`) و مدت زمان شبیه‌سازی (`durationMs`) را تغییر دهید.
    * **توجه:** برای جلوگیری از مشکلات نمایشی ناشی از شکستن خطوط متن (text wrapping) در کتابخانه گرافیکی، توصیه می‌شود نام قطعات نسبتاً کوتاه انتخاب شوند.
* **`YELLOW_SECTION_HEIGHT`:** این مقدار در ابتدای کد قابل تنظیم است و ارتفاع بخش زرد نمایشگرهای دو رنگ را مشخص می‌کند.

## محدودیت‌های فعلی

* **شکستن متن (Text Wrapping) با تورفتگی:** کتابخانه Adafruit GFX به طور پیش‌فرض، خطوط ثانویه حاصل از شکستن یک متن طولانی (auto-wrap) را از ابتدای سطر (X=0) نمایش می‌دهد، حتی اگر خط اول تورفتگی داشته باشد. این موضوع ممکن است در نمایش نام‌های بسیار طولانی قطعات که نیاز به شکستن دارند، کمی ناهماهنگی بصری ایجاد کند.
* **وابستگی رنگ به سخت‌افزار:** نمایش رنگ‌های زرد و آبی کاملاً به سخت‌افزار نمایشگر OLED دو رنگ وابسته است و این کد صرفاً با چینش صحیح عناصر از این قابلیت بهره می‌برد.

## بهبودهای بالقوه (نقشه راه آینده)

* افزودن جزئیات بیشتر به تست‌های شبیه‌سازی شده.
* امکان پیکربندی لیست تست‌ها از طریق ورودی سریال یا فایل.
* استفاده از فونت‌های سفارشی برای بهبود بیشتر ظاهر گرافیکی.
* پیاده‌سازی یک تابع سفارشی برای مدیریت شکستن متن با حفظ تورفتگی.

## توسعه‌دهنده

Arian Alijani

---
